<?xml version="1.0" encoding="UTF-8"?>
<section xml:id="inv-4-4-sleep">
  <title>Investigation 4.4: Lingering Effects of Sleep Deprivation</title>

  <introduction>
      <p>Researchers have established that sleep deprivation has a harmful effect on visual learning (the subject does not consolidate information to improve on the task). Stickgold, James, and Hobson (<url href="https://www.nature.com/articles/nn1200_1237">2000</url>) investigated whether subjects could <q>make up</q> for sleep deprivation by getting a full night's sleep in subsequent nights.</p>
    
    <sidebyside widths="60% 35%" margins="0% 5%">
    <p>This study involved randomly assigning 21 subjects (volunteers between the ages of 18 and 25) to one of two groups: one group was deprived of sleep on the night following training with a visual discrimination task, and the other group was permitted unrestricted sleep on that first night. Both groups were allowed unrestricted sleep on the following two nights, and then were re-tested on the third day. </p>
      <image source="images/Inv4.4intro.png">
        <description>Introduction to the sleep deprivation study</description>
      </image>
    </sidebyside>
    <p>Subjects' performance on the test was recorded as the minimum time (in milliseconds) between stimuli appearing on a computer screen for which they could accurately report what they had seen on the screen. Previous studies had shown that subjects deprived of sleep performed significantly worse the following day, but it was not clear how long these negative effects would last. The data presented here are the improvements in reaction times (in milliseconds), so a negative value indicates a decrease in performance.</p>
    <p>Sleep deprivation group (<m>n = 11</m>): -10.7, 4.5, 2.2, 21.3, -14.7, -10.7, 9.6, 2.4, 21.8, 7.2, 10.0</p>
    <p>Unrestricted sleep group (<m>n = 10</m>): 25.2, 14.5, -7.0, 12.6, 34.5, 45.6, 11.6, 18.6, 12.1, 30.5</p>
  </introduction>
  
  <p><strong>Study Design</strong></p>
      
  <exercise xml:id="inv4-4-a" label="I4.4.1">
        <title>Experiment or Observational Study</title>
        <statement>
          <p>Is this an experiment or an observational study?</p>
        </statement>
        <choices randomize="no">
          <choice correct="yes">
            <statement><p>Experiment</p></statement>
          </choice>
          <choice>
            <statement><p>Observational study</p></statement>
          </choice>
        </choices>
        <response/>
        <statement>
          <p>Explain: <var width="60"/></p>
        </statement>
        <solution>
          <p>This is an experiment because researchers determined which subjects would be sleep deprived.</p>
        </solution>
      </exercise>
      
      <exercise xml:id="inv4-4-b" label="I4.4.2">
        <title>Identify Variables</title>
        <statement>
          <p>Identify the explanatory (EV) and response (RV) variables. Also classify each as being categorical or quantitative.</p>
          <p>EV: <var width="40"/></p>
          <p>type: <var width="20"/></p>
          <p>RV: <var width="40"/></p>
          <p>type: <var width="20"/></p>
        </statement>
        <solution>
          <p>EV: Was the subject sleep deprived? type: Binary categorical</p>
          <p>RV: What was the subject's improvement score? type: Quantitative</p>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-c" label="I4.4.3">
        <title>State Hypotheses</title>
        <statement>
          <p>Write out the null and alternative hypotheses, in words, for this research study.</p>
        </statement>
        <solution>
          <p><m>H_0</m>: There is no difference in improvement scores on average between these two treatments (in the long run).</p>
          <p><m>H_a</m>: On average, improvement scores are higher for unrestricted sleep treatment.</p>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-d" label="I4.4.4">
        <title>One-sided or Two-sided</title>
        <statement>
          <p>Is your alternative hypothesis one-sided or two-sided? What does this imply about the types of response values you would expect to see in each treatment group?</p>
        </statement>
        <hint>
          <p>Positive or negative?</p>
        </hint>
        <response/>
        <solution>
          <p>The alternative hypothesis is one-sided; we expect to see positive improvement scores in each group, but higher scores in the unrestricted sleep group.</p>
        </solution>
  </exercise>
    
  <p><strong>Descriptive Statistics</strong></p>
      
  <p>The following dotplots reveal the distributions of improvements between the two groups:</p>
      
      <image source="images/Inv4.4e.png" width="80%">
        <description>Dotplots comparing improvement scores between sleep deprived and unrestricted sleep groups</description>
      </image>
      
      <exercise xml:id="inv4-4-e" label="I4.4.5">
        <title>Preliminary Evidence</title>
        <statement>
          <p>Do these data provide preliminary evidence that the harmful effects of sleep deprivation linger three days later? Explain your reasoning.</p>
        </statement>
        <hint>
          <p>Are all the improvement scores in one group higher than all the improvement scores in the other group? Is there a tendency for higher improvement scores in one group three days later?</p>
        </hint>
        <response/>
        <solution>
          <p>On average, the improvement score was higher for unrestricted group. We see a tendency for higher improvement scores in the unrestricted group (the dotplot is shifted to the right compared to the sleep deprived group dotplot).</p>
        </solution>
      </exercise>
      
      <exercise xml:id="inv4-4-f" label="I4.4.6">
        <title>Calculate Observed Difference</title>
        <statement>
          <p>There are several ways we could choose to measure the tendency observed in <xref ref="inv4-4-e" text="custom">checkpoint 16.1.5</xref>. A common choice of statistic is of course the difference in group means. Calculate this statistic by subtracting the <q>deprived</q> group's value from the <q>unrestricted</q> group's value.</p>
          <p>Observed difference in sample means: <m>\bar{x}_{\text{unrestricted}} - \bar{x}_{\text{deprived}} = </m> <var width="10"/></p>
        </statement>
        <solution>
          <p><m>\bar{x}_{\text{deprived}} = 3.90</m> ms</p>
          <p><m>\bar{x}_{\text{unrestricted}} = 19.82</m> ms</p>
          <p>Difference: <m>19.82 - 3.90 = 15.92</m> ms</p>
          <p>Note: The observed difference (unres - deprived) is <m>15.92</m> ms. </p>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-g" label="I4.4.7">
        <title>Could It Be Chance</title>
        <statement>
          <p>Is it possible that the differences seen here could have occurred just by chance variation, due to the random assignment of subjects to groups, even if there were really no effect of the sleep condition on improvement?</p>
        </statement>
        <solution>
          <p>It is possible <mdash/> random assignment alone could conceivably lead to a large difference in the group means.</p>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-h" label="I4.4.8">
        <title>Source of Chance</title>
        <statement>
          <p>As usual, we want to know how plausible it is for us to obtain a difference in sample means at least as extreme as the observed value by chance alone. What is the source of <q>chance</q> in this study?</p>
        </statement>
        <solution>
          <p>Random assignment</p>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-i" label="I4.4.9">
        <title>Outline Simulation</title>
        <statement>
          <p>Outline the steps of a simulation analysis that would explore the <q>could have been</q> outcomes under the null hypothesis by modelling the randomness described in <xref ref="inv4-4-h" text="custom">checkpoint 16.1.8</xref>.</p>
        </statement>
        <solution>
          <p>We want to simulate the random assignment by assuming everyone would get the same improvement score, regardless of which group they end up in, and randomly assign the subjects into 2 groups of <m>n_1 = 11</m> and <m>n_2 = 10</m>. Then see how frequently you get <m>\bar{x}_1 - \bar{x}_2 > 15.92</m>.</p>
        </solution>
        <response/>
      </exercise>
    
  <p><strong>Statistical Inference</strong></p>
      
  <p>As with the <q>dolphin therapy</q> experiment from Chapter 3, we again need to judge the strength of evidence that the experimental data provide in support of the researchers' conjecture that sleep deprivation has a harmful effect on learning. We are now working with a quantitative response variable rather than a categorical one, but we will use the same basic logic of statistical significance: We will ask whether the observed experimental results are very unlikely to have occurred by chance variation if the explanatory variable has no effect, that is, if the values in the two groups are interchangeable. To simulate this randomization test: We will take the observed response variable outcomes, randomly distribute these numerical values between the two groups, compute the statistic of interest (e.g., the difference in group means), repeat this process a large number of times, and see how often the random assignment process alone produces a difference in group means as extreme as in the actual research study. This is similar to what you considered in Investigation 4.1. However, this time it is not really feasible to list out all possible <m>C(21,10) = 352,716</m> random assignments and consider the value of the statistic for each one, so we will simulate a large number of random assignments instead. Note, we need to know the value of <m>(\bar{x}_1 - \bar{x}_2)</m>, not just the <q>number of successes</q> as with the dolphin therapy study.</p>
      
      <exercise xml:id="inv4-4-j" label="I4.4.10">
        <title>Physical Simulation</title>
        <statement>
          <p>Take a set of 21 index cards, and write each of the improvement values on a card. Then shuffle the cards and deal out 10 of them to represent the subjects randomly assigned to the <q>unrestricted sleep</q> group and 11 to represent the <q>sleep deprived group.</q> Calculate the mean of the improvements in each group. Then calculate the difference in group means, subtracting in the same order as before.</p>
          <p>Simulated difference in means (<m>\bar{x}_{\text{unrestricted}} - \bar{x}_{\text{deprived}}</m>): <var width="10"/></p>
        </statement>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-k" label="I4.4.11">
        <title>Compare to Observed</title>
        <statement>
          <p>Is your simulated result for the difference in means as extreme as the actual experimental result? Explain. Why is looking at this one simulated difference not enough to assess statistical significance?</p>
        </statement>
        <solution>
          <p>Results will vary. Looking at just one simulated difference is not enough because we need to understand the entire distribution of what could happen by chance alone to determine how often (what proportion of the time) random assignment alone produces results as extreme as what we observed.</p>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-l" label="I4.4.12">
        <title>Combine Class Results</title>
        <statement>
          <p>Combine your results with your classmates to produce a dotplot of the difference in group means.</p>
        </statement>
        <response/>
      </exercise>
      
      <p>Simulating more repetitions would provide a better understanding of how significant (i.e., unlikely to have happened by random assignment alone) the observed experimental results are. In other words, more repetitions will enable us to approximate the p-value more accurately. We will again turn to technology to perform the simulation more quickly and efficiently.</p>
      
      <exercise xml:id="inv4-4-m" label="I4.4.13">
        <title>Use Applet for Simulation</title>
        <statement>
          <p>Open the <url href="https://www.rossmanchance.com/applets/2021/comparinggroups/CompGroups.htm">Comparing Groups (Quantitative) applet</url>. You will see dotplots of the research results. Verify the calculation of the observed difference in group means. (This applet subtracts the top row from the bottom row.)</p>
          <ul>
            <li><p>Check the Show Shuffle Options box.</p></li>
            <li><p>Select the Plot radio button.</p></li>
            <li><p>Press the Shuffle Responses button.</p></li>
          </ul>
          <p>The applet combines all the scores into one pile, reassigns the group labels (red and black coloring) at random, and then redistributes the observations to the two treatment groups, just like you did with the index cards.</p>
          <p>What did you find for the difference in group means? <var width="10"/></p>
          <p>Is this more extreme than the observed difference in group means in the research study? <var width="10"/></p>
        </statement>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-n" label="I4.4.14">
        <title>More Repetitions</title>
        <statement>
          <p>Press Shuffle Responses four more times. With each new <q>could have been</q> result (each new random assignment), the applet calculates the difference in group means and adds a dot to the dotplot to the right. Identify what each dot represents in the dotplot on the far right.</p>
        </statement>
        <solution>
          <p>Each dot is the value of <m>\bar{x}_1 - \bar{x}_2</m> after one reshuffling of the data values (What is the difference in sample means with each random assignment?).</p>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-o" label="I4.4.15">
        <title>Expected Mean of Null Distribution</title>
        <statement>
          <p>As we conduct more and more repetitions, what do you expect the mean of this null distribution of difference in group means to be close to? Explain.</p>
        </statement>
        <solution>
          <p>Zero (under null hypothesis)</p>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-p" label="I4.4.16">
        <title>Generate Full Distribution</title>
        <statement>
          <p>Change the Number of repetitions from 1 to 995 (to produce a total of 1,000 repetitions). Press Shuffle Responses. Describe the shape, mean, and standard deviation of the resulting dotplot. Explain what is represented by this standard deviation.</p>
          <p>Shape: <var width="30"/></p>
          <p>Mean: <var width="10"/></p>
          <p>Standard deviation: <var width="10"/></p>
          <p>Interpretation: <var width="60"/></p>
        </statement>
        <solution>
          <p>Shape: symmetric</p>
          <p>Mean: <m>\approx 0</m></p>
          <p>SD: <m>\approx 7</m></p>
          <p>Interpretation: typical deviation from the mean</p>
          <p>Example results:</p>
          <image source="images/Inv4.4solsp.png" width="60%">
            <description>Example randomization distribution showing 1000 simulated differences in means</description>
          </image>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-q" label="I4.4.17">
        <title>Calculate p-value</title>
        <statement>
          <p>Now enter the observed difference in group means (checkpoint 16.1.6) from the research study into the Count Samples box, use the Greater Than option (to match our alternative hypothesis), and press the Count button. What does the applet report for the empirical p-value?</p>
        </statement>
        <solution>
          <p>Counting <m>\geq 15.92</m> (this is the direction specified by the alternative hypothesis), the p-value should be about 0.007.</p>
          <image source="images/Inv4.4solsq.png" width="60%">
            <description>Example randomization distribution with p-value calculation</description>
          </image>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-r" label="I4.4.18">
        <title>Interpret p-value</title>
        <statement>
          <p>Provide an interpretation of this p-value in context (make sure you address the statistic, the source of the randomness in the study, and what you mean by <q>more extreme</q>).</p>
        </statement>
        <solution>
          <p>The p-value is the percentage of random assignments, when the null hypothesis is true (<m>H_0: \mu_{\text{unrestricted}} - \mu_{\text{deprived}} = 0</m>, no treatment effect) that will have <m>\bar{x}_{\text{unrestricted}} - \bar{x}_{\text{deprived}} \geq 15.92</m> by chance (random sampling) alone.</p>
        </solution>
        <response/>
      </exercise>
    
  <p><strong>Conclusions</strong></p>
      
  <exercise xml:id="inv4-4-s" label="I4.4.19">
        <title>Statistical Significance</title>
        <statement>
          <p>What conclusion would you draw from this simulation analysis regarding the question of whether the learning improvements in the sleep deprived group are statistically significantly lower (on average) than those in the unrestricted sleep group? Also explain the reasoning process by which your conclusion follows from the simulation results.</p>
        </statement>
        <solution>
          <p>With a p-value below 0.01, reject <m>H_0</m> because p-value is small, in favor of <m>H_a: \mu_{\text{unrestricted}} - \mu_{\text{deprived}} > 0</m>. We have convincing evidence that the observed difference in means is not just due to random chance but instead that the underlying treatment mean for the unrestricted group is higher than for the sleep deprived treatment.</p>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-t" label="I4.4.20">
        <title>Causation</title>
        <statement>
          <p>Does the design of this study allow you to conclude that the reduction in improvement scores is caused by the sleep deprivation? Explain.</p>
        </statement>
        <solution>
          <p>Yes, because of the random assignment to treatment groups, and the result was statistically significant.</p>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-u" label="I4.4.21">
        <title>Generalizability</title>
        <statement>
          <p>To what <q>population</q> is it reasonable to generalize these results?</p>
        </statement>
        <solution>
          <p>Maybe volunteers between 18-25 years old (but not clear whether this study used any random sampling).</p>
        </solution>
        <response/>
      </exercise>
    
  <p><strong>Exact p-value?</strong></p>
      
  <p>Although not as convenient as before, we can determine the exact p-value for this randomization test by considering all the different possible random assignments of these 21 subjects into groups of 11 and 10, determining the difference in means (or medians) for each, and then counting how many are at least as extreme as the observed difference.</p>
      
      <p>The following histogram (produced using the <c>combn</c> function in R, from the <c>combinat</c> package, assuming <c>imprvs</c> contains the response variable values) shows the distribution of all 352,716 possible differences in group means.</p>
      
      <image source="images/Inv4.4v.png" width="60%">
        <description>Histogram showing exact randomization distribution of all 352,716 possible differences in group means</description>
      </image>
      
      <program language="r">
        <input>
indices = 1:21
allcombs = combn(21, 10)

diffs = 1:ncol(allcombs)

for (i in 1:ncol(allcombs)){
  group1=imprvs[allcombs[,i]]
  group2=imprvs[setdiff(indices, allcombs[,i])]
  diffs[i]=mean(group1)-mean(group2)
}

hist(diffs)
abline(v=15.92, col=2)

# approx. run time: 1 min
        </input>
      </program>
      
      <exercise xml:id="inv4-4-v" label="I4.4.22">
        <title>Compare Simulation to Exact</title>
        <statement>
          <p>Do your simulation results reasonably approximate this null distribution?</p>
        </statement>
        <solution>
          <p>The distributions are quite similar.</p>
        </solution>
        <response/>
      </exercise>
      
      <exercise xml:id="inv4-4-w" label="I4.4.23">
        <title>Calculate Exact p-value</title>
        <statement>
          <p>It turns out that 2533 of the 352,716 different random assignments produce a difference in group means of 15.92 milliseconds or larger. Use this information to determine the exact p-value of this randomization test. Is the approximate p-value from your simulation close?</p>
        </statement>
        <solution>
          <p>2533/352,716 = 0.0072</p>
          <p>This should be similar to the approximate p-value from 1000 repetitions of the random assignment.</p>
        </solution>
        <response/>
      </exercise>
      
      <p><alert>Discussion:</alert> The exact randomization distribution consists of every possible random assignment and calculates the statistic of interest (e.g., difference in means) for each one. Then we simply count how many of the configurations result in a value of the statistic at least as extreme (as defined by the alternative hypothesis) as the actual observed result. As you might expect, it can be extremely tedious, even with computers, to list out all of these possible random assignments. And these group sizes are relatively small! One shortcut is to only count how many assignments give results more extreme than the one observed, but as you will see we can often appeal to a mathematical model as well.</p>
      
      <assemblage xml:id="tech-detour-4-4">
        <title>Technology Detour <mdash/> Simulating a Randomization Test for a Quantitative Response</title>
        
        <p><alert>Step 1:</alert> Randomly reorder the group membership labels (keeping the same number in each group)</p>
        <p><alert>Step 2:</alert> Calculate the new difference in means (or other statistic) using the reordered group labels</p>
        <p><alert>Step 3:</alert> Repeat Steps 1 and 2 many times.</p>
        <p>Look at the distribution of the statistic, including the mean and standard deviation, and count how many of the simulated statistics are as or more extreme as the observed.</p>
        
        <p><alert>Applet:</alert> <url href="https://www.rossmanchance.com/applets/2021/comparinggroups/CompGroups.htm">Comparing Groups (Quantitative)</url></p>
        
        <p><alert>In R:</alert> See <url href="https://www.rossmanchance.com/iscam3/data/RandomizationTestQuantR.html">RandomizationTestQuantR.html</url> (with Sleep Deprivation file loaded and attached)</p>
        
        <p><alert>In JMP:</alert> See <url href="https://www.rossmanchance.com/iscam3/data/RandomizationTestQuantJMP.html">RandomizationTestQuantJMP.html</url></p>
      </assemblage>
    
  <assemblage xml:id="inv-4-4-study-conclusions">
    <title>Study Conclusions</title>
      
      <p>These data come from a randomized, comparative experiment. The dotplots and descriptive statistics reveal that, even three days later, the sleep-deprived subjects tended (on average) to have lower improvements than those permitted unrestricted sleep. To investigate whether this difference is larger than could be expected from random assignment alone (assuming no real difference between the two treatment conditions, our null hypothesis), you simulated a <strong>randomization test</strong> by assigning the 21 measurements (improvement scores) to the two groups at random. You should have found that random assignment alone rarely produced differences in group means as extreme as in the actual study (the <q>exact</q> p-value is less than 0.01). Thus, we have fairly strong evidence that the average learning improvement is genuinely lower for the sleep deprived subjects. Moreover, because this was a randomized comparative experiment and not an observational study, we can draw a causal conclusion that the sleep deprivation was the cause of the lower learning improvements. However, the subjects were college-aged volunteers, so we may not want to generalize these results to a much different population.</p>
  </assemblage>
  
  <p><strong>Practice Problems</strong></p>
    
  <p><strong>Practice Problem 4.4A</strong></p>
      
  <exercise xml:id="pp4-4a-1" label="PP4.4A.1">
        <statement>
          <p>Consider <url href="https://www.nature.com/articles/nn1200_1237/figures/1">Figure 1</url> in the Stickgold et al. study. What information was the graph intending to convey?</p>
        </statement>
        <response/>
      </exercise>
      
      <exercise xml:id="pp4-4a-2" label="PP4.4A.2">
        <statement>
          <p>What important details are not conveyed in Figure 1 that dotplots would have shown better?</p>
        </statement>
        <response/>
      </exercise>
      
      <exercise xml:id="pp4-4a-3" label="PP4.4A.3">
        <statement>
          <p>Explain how the simulation analysis conducted in this investigation differs from Investigation 4.2. (What is the random process being simulated? What assumptions are underlying the simulation?)</p>
        </statement>
        <solution>
          <p>In Investigation 4.2 (comparing elephant walking distances), we simulated the random sampling process from two populations under the assumption that the population means are equal. In Investigation 4.4, we simulated the random assignment process in an experiment under the assumption that the treatment has no effect (so the response values would be the same regardless of which group the subject was assigned to). Investigation 4.2 deals with observational data and random sampling; Investigation 4.4 deals with experimental data and random assignment.</p>
        </solution>
        <response/>
      </exercise>
    
  <p><strong>Practice Problem 4.4B</strong></p>
      
  <exercise xml:id="pp4-4b-1" label="PP4.4B.1">
        <statement>
          <p>Produce numerical and graphical summaries for the data in <url href="https://raw.githubusercontent.com/iambethchance/iscam-runestone/master/data/FakeSleepDeprivation.txt">FakeSleepDeprivation.txt</url>, representing a new set of 21 responses for the sleep deprivation study. Comment on how the shapes, centers, and variability for the two distributions compare between these data and the original data.</p>
        </statement>
        <response/>
      </exercise>
      
      <exercise xml:id="pp4-4b-2" label="PP4.4B.2">
        <statement>
          <p>Use technology (see Technology Detour) to carry out a randomization test to compare the improvements for the sleep deprived and unrestricted sleep groups using the hypothetical data. Indicate how you approximated the p-value.</p>
        </statement>
        <response/>
      </exercise>
      
      <exercise xml:id="pp4-4b-3" label="PP4.4B.3">
        <statement>
          <p>How does the p-value for the hypothetical data compare to the p-value for the original data? Explain why this makes sense based on what you learned about how the data sets compared in checkpoint 16.1.27.</p>
        </statement>
        <response/>
      </exercise>
  
</section>